---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Theory - Ultrasound Focusing Principles" description="Mathematical and physical principles behind ultrasound array focusing and beamforming">
  <div class="theory-container">
    <div class="page-header">
      <h1>üìê Theory of Ultrasound Focusing</h1>
      <p>Understanding the mathematical and physical principles that govern ultrasound array focusing, beamforming, and wave interference.</p>
    </div>

    <section class="theory-section">
      <h2>Fundamental Principles</h2>

      <div class="principle-card">
        <h3>Wave Equation</h3>
        <p>Ultrasound propagation in a medium is governed by the acoustic wave equation:</p>
        <div class="equation">
          ‚àá¬≤p - (1/c¬≤)(‚àÇ¬≤p/‚àÇt¬≤) = 0
        </div>
        <p>Where <em>p</em> is pressure, <em>c</em> is speed of sound, and <em>t</em> is time.</p>
      </div>

      <div class="principle-card">
        <h3>Huygens' Principle</h3>
        <p>Every point on a wavefront acts as a source of secondary wavelets. The envelope of these wavelets forms the new wavefront. This principle explains how ultrasound arrays can focus and steer beams through constructive interference.</p>
      </div>

      <div class="principle-card">
        <h3>Superposition</h3>
        <p>When multiple waves overlap, the resulting amplitude is the sum of individual wave amplitudes. This is the fundamental principle behind:</p>
        <ul>
          <li><strong>Constructive interference:</strong> Waves in phase add together</li>
          <li><strong>Destructive interference:</strong> Waves out of phase cancel</li>
          <li><strong>Focusing:</strong> Timed delays create constructive interference at target</li>
        </ul>
      </div>
    </section>

    <section class="theory-section">
      <h2>Array Focusing Mathematics</h2>

      <div class="principle-card">
        <h3>Time Delay Calculation</h3>
        <p>To focus at point (x‚ÇÄ, y‚ÇÄ), each array element at position (x·µ¢, y·µ¢) requires a delay:</p>
        <div class="equation">
          œÑ·µ¢ = (R_max - R·µ¢) / c
        </div>
        <p>Where:</p>
        <ul>
          <li>R·µ¢ = ‚àö[(x‚ÇÄ - x·µ¢)¬≤ + (y‚ÇÄ - y·µ¢)¬≤] is the distance from element i to focus</li>
          <li>R_max is the maximum distance among all elements</li>
          <li>c is the speed of sound</li>
        </ul>
      </div>

      <div class="principle-card">
        <h3>Beam Steering</h3>
        <p>For linear arrays, steering at angle Œ∏ requires linear delays:</p>
        <div class="equation">
          œÑ·µ¢ = i √ó d √ó sin(Œ∏) / c
        </div>
        <p>Where <em>d</em> is element spacing and <em>i</em> is element index.</p>
      </div>

      <div class="principle-card">
        <h3>Focal Zone Characteristics</h3>
        <p>The focal zone dimensions depend on array geometry:</p>
        <div class="equation-block">
          <div class="equation">Lateral resolution ‚âà ŒªF/D</div>
          <div class="equation">Axial resolution ‚âà c/(2B)</div>
          <div class="equation">Depth of field ‚âà ŒªF¬≤/D¬≤</div>
        </div>
        <p>Where Œª is wavelength, F is focal distance, D is aperture size, and B is bandwidth.</p>
      </div>
    </section>

    <section class="theory-section">
      <h2>Advanced Concepts</h2>

      <div class="principle-card">
        <h3>Apodization</h3>
        <p>Weighting functions applied to array elements to reduce side lobes:</p>
        <ul>
          <li><strong>Uniform:</strong> Equal amplitude for all elements</li>
          <li><strong>Hamming:</strong> w(n) = 0.54 - 0.46cos(2œÄn/N)</li>
          <li><strong>Gaussian:</strong> Smooth amplitude taper</li>
        </ul>
        <p>Trade-off: Reduced side lobes vs. wider main lobe</p>
      </div>

      <div class="principle-card">
        <h3>Dynamic Focusing</h3>
        <p>Continuously adjust focus during receive to maintain optimal resolution at all depths. Requires real-time delay calculations and beamforming.</p>
      </div>

      <div class="principle-card">
        <h3>Coherent Compounding</h3>
        <p>Combine multiple steered beams to improve image quality:</p>
        <ul>
          <li>Reduces speckle noise</li>
          <li>Improves contrast resolution</li>
          <li>Enhances boundary definition</li>
        </ul>
      </div>
    </section>

    <section class="theory-section">
      <h2>Practical Considerations</h2>

      <div class="principle-card">
        <h3>Grating Lobes</h3>
        <p>Unwanted beams that occur when element spacing is too large:</p>
        <div class="equation">
          d &lt; Œª/(1 + |sin(Œ∏_max)|)
        </div>
        <p>Where Œ∏_max is the maximum steering angle. Typically d &le; Œª/2 to avoid grating lobes.</p>
      </div>

      <div class="principle-card">
        <h3>Near Field Effects</h3>
        <p>In the near field (Fresnel zone), beam behavior is complex:</p>
        <div class="equation">
          N = D¬≤/(4Œª)
        </div>
        <p>Where N is the near field distance. Focusing is most effective beyond this distance.</p>
      </div>

      <div class="principle-card">
        <h3>Attenuation and Absorption</h3>
        <p>Ultrasound energy decreases with depth due to:</p>
        <ul>
          <li><strong>Absorption:</strong> Energy converted to heat (~0.5 dB/cm/MHz in soft tissue)</li>
          <li><strong>Scattering:</strong> Energy redirected (Rayleigh and geometric scattering)</li>
          <li><strong>Beam divergence:</strong> Energy spread over larger area</li>
        </ul>
      </div>
    </section>

    <section class="theory-section">
      <h2>Applications and Trade-offs</h2>

      <div class="principle-card">
        <h3>Medical Imaging</h3>
        <p>Different applications require different focusing strategies:</p>
        <ul>
          <li><strong>B-mode imaging:</strong> Sequential focusing for 2D images</li>
          <li><strong>Doppler:</strong> Continuous wave or pulsed focusing</li>
          <li><strong>Therapeutic:</strong> High-intensity focused ultrasound (HIFU)</li>
        </ul>
      </div>

      <div class="principle-card">
        <h3>Design Trade-offs</h3>
        <div class="tradeoff-grid">
          <div class="tradeoff">
            <strong>Resolution vs. Penetration</strong>
            <p>Higher frequency improves resolution but reduces penetration</p>
          </div>
          <div class="tradeoff">
            <strong>Focus Quality vs. Coverage</strong>
            <p>Tighter focus improves quality but reduces field of view</p>
          </div>
          <div class="tradeoff">
            <strong>Element Count vs. Complexity</strong>
            <p>More elements improve performance but increase system complexity</p>
          </div>
          <div class="tradeoff">
            <strong>Frame Rate vs. Image Quality</strong>
            <p>Faster imaging reduces time for optimal focusing</p>
          </div>
        </div>
      </div>
    </section>

    <section class="theory-section">
      <h2>Further Reading</h2>
      <div class="resources">
        <div class="resource-category">
          <h4>Textbooks</h4>
          <ul>
            <li>Szabo, T.L. "Diagnostic Ultrasound Imaging: Inside Out"</li>
            <li>Jensen, J.A. "Estimation of Blood Velocities Using Ultrasound"</li>
            <li>Kino, G.S. "Acoustic Waves: Devices, Imaging, and Analog Signal Processing"</li>
          </ul>
        </div>
        <div class="resource-category">
          <h4>Key Papers</h4>
          <ul>
            <li>O'Donnell, M. & Flax, S.W. "Phase aberration measurements in medical ultrasound"</li>
            <li>Jensen, J.A. "Field: A program for simulating ultrasound systems"</li>
            <li>Lockwood, J.C. & Willette, J.G. "High-speed method for computing exact solutions"</li>
          </ul>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  .theory-container {
    max-width: 900px;
    margin: 0 auto;
  }

  .page-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 12px;
  }

  .page-header h1 {
    font-size: 2.5rem;
    margin: 0 0 1rem 0;
    color: #1e293b;
  }

  .page-header p {
    font-size: 1.125rem;
    color: #64748b;
    margin: 0;
    line-height: 1.7;
  }

  .theory-section {
    margin-bottom: 3rem;
  }

  .theory-section h2 {
    font-size: 2rem;
    color: #1e293b;
    margin-bottom: 2rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid #06b6d4;
  }

  .principle-card {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border: 1px solid #e2e8f0;
    margin-bottom: 1.5rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .principle-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  }

  .principle-card h3 {
    color: #1e293b;
    margin: 0 0 1rem 0;
    font-size: 1.5rem;
  }

  .principle-card h4 {
    color: #374151;
    margin: 1.5rem 0 0.75rem 0;
    font-size: 1.25rem;
  }

  .principle-card p {
    color: #64748b;
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .principle-card ul {
    color: #64748b;
    line-height: 1.7;
    padding-left: 1.5rem;
  }

  .principle-card li {
    margin-bottom: 0.5rem;
  }

  .equation {
    background: #1e293b;
    color: #f8fafc;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 1.125rem;
    text-align: center;
    margin: 1.5rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .equation-block {
    background: #1e293b;
    color: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1.5rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .equation-block .equation {
    background: none;
    padding: 0.5rem 0;
    margin: 0;
    box-shadow: none;
    font-size: 1rem;
  }

  .tradeoff-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .tradeoff {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
  }

  .tradeoff strong {
    color: #1e293b;
    display: block;
    margin-bottom: 0.5rem;
    font-size: 1.125rem;
  }

  .tradeoff p {
    margin: 0;
    font-size: 0.875rem;
  }

  .resources {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .resource-category {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border: 1px solid #e2e8f0;
  }

  .resource-category h4 {
    color: #1e293b;
    margin: 0 0 1rem 0;
    font-size: 1.25rem;
    border-bottom: 2px solid #06b6d4;
    padding-bottom: 0.5rem;
  }

  .resource-category ul {
    margin: 0;
    padding-left: 1.5rem;
  }

  .resource-category li {
    color: #64748b;
    line-height: 1.6;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .theory-container {
      padding: 0 1rem;
    }

    .page-header {
      padding: 1.5rem;
    }

    .page-header h1 {
      font-size: 2rem;
    }

    .page-header p {
      font-size: 1rem;
    }

    .theory-section h2 {
      font-size: 1.75rem;
    }

    .principle-card {
      padding: 1.5rem;
    }

    .principle-card h3 {
      font-size: 1.25rem;
    }

    .equation {
      font-size: 1rem;
      padding: 0.875rem 1rem;
    }

    .tradeoff-grid {
      grid-template-columns: 1fr;
    }

    .resources {
      grid-template-columns: 1fr;
    }
  }
</style>
